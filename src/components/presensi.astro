<div id="comp-presensi" class="px-4 py-16">
    <div class="flex justify-center items-center">
        <button
            id="btn-presensi"
            class="py-2 px-4 bg-green-700 text-green-50 rounded-md hover:opacity-85"
            >Presensi</button
        >
    </div>
</div>

<script>
    import { getCookie } from "../lib/storage";
    import { servicePresensi } from "../services/bkn";
    import Swal from "sweetalert2";

    const btnPresensi = document.getElementById(
        "btn-presensi",
    ) as HTMLButtonElement;

    const comp = document.getElementById("comp-presensi") as HTMLDivElement;

    const main = async () => {
        const check = getCookie("isVerif");
        if (check) {
            comp.classList.remove("hidden");
        }
    };

    btnPresensi.addEventListener("click", async () => {
        // Tampilkan loading
        Swal.fire({
            title: "Memproses presensi...",
            text: "Mohon tunggu sebentar",
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            },
        });

        try {
            const data = await servicePresensi();
            Swal.close(); // Tutup loading

            // Cek apakah response berhasil
            if (!data?.status) {
                Swal.fire({
                    title: "Presensi Gagal",
                    text: data?.message || "Terjadi kesalahan saat presensi",
                    icon: "error",
                });
                return;
            }

            Swal.fire({
                title: "Presensi Berhasil",
                text: data?.message || "Anda berhasil melakukan presensi",
                icon: "success",
            });

            // Kalau perlu, update UI (misalnya isi <ul>)
        } catch (error) {
            Swal.close();
            Swal.fire({
                title: "Terjadi Kesalahan",
                text: "Tidak dapat menghubungi server presensi",
                icon: "error",
            });
            console.error("Presensi error:", error);
        }
    });

    main();
</script>
